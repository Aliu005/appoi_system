<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ - Ø£Ù…Ø§Ù†Ø© Ø§Ù„Ø£Ø­Ø³Ø§Ø¡</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
      import { getFirestore, collection, addDoc } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';

      // ğŸ”¥ Firebase Configuration - Ù†ÙØ³ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ù† index-firebase.html
      const firebaseConfig = {
  apiKey: "AIzaSyCmv3l8_CKMjP1Wo3G7FpM4f6ox59gQb7g",
  authDomain: "test-one-6c755.firebaseapp.com",
  projectId: "test-one-6c755",
  storageBucket: "test-one-6c755.firebasestorage.app",
  messagingSenderId: "103909985339",
  appId: "1:103909985339:web:e827353eab071a76cca01e",
  measurementId: "G-41VG1LCE5L"
};

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      window.firebaseDB = db;
      window.collection = collection;
      window.addDoc = addDoc;
    </script>

    <style>
        /* Ù†ÙØ³ Ø§Ù„ØªØµÙ…ÙŠÙ… Ù…Ù† Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø£ØµÙ„ÙŠ */
        :root {
            --primary-color: #1a5f3f;
            --secondary-color: #d4af37;
            --success-color: #22c55e;
            --danger-color: #ef4444;
            --gradient-primary: linear-gradient(135deg, #1a5f3f 0%, #2d7d5f 50%, #d4af37 100%);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --border-radius-xl: 24px;
        }

        * {
            font-family: 'Tajawal', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
        }

        .booking-card {
            background: white;
            border-radius: var(--border-radius-xl);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            margin: 50px auto;
        }

        .card-header {
            background: var(--gradient-primary);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .card-header h2 {
            font-weight: 800;
            margin-bottom: 10px;
        }

        .form-control, .form-select {
            border: 2px solid rgba(26, 95, 63, 0.2);
            border-radius: 12px;
            padding: 15px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(26, 95, 63, 0.1);
        }

        .btn-primary {
            background: var(--gradient-primary);
            border: none;
            padding: 15px 40px;
            font-weight: 700;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .alert {
            border: none;
            border-radius: 12px;
            padding: 20px;
        }

        .spinner-border {
            width: 20px;
            height: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="booking-card">
            <div class="card-header">
                <h2><i class="fas fa-calendar-plus me-3"></i>Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ Ø¬Ø¯ÙŠØ¯</h2>
                <p class="mb-0">Ø£Ù…Ø§Ù†Ø© Ø§Ù„Ø£Ø­Ø³Ø§Ø¡ - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</p>
            </div>
            
            <div class="card-body p-4">
                <!-- Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ -->
                <div id="alertContainer"></div>
                
                <form id="bookingForm">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© *</label>
                            <input type="text" class="form-control" id="nationalId" 
                                   placeholder="1234567890" maxlength="10" required>
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *</label>
                            <input type="text" class="form-control" id="fullName" 
                                   placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ" required>
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ *</label>
                            <input type="tel" class="form-control" id="phoneNumber" 
                                   placeholder="05xxxxxxxx" required>
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label fw-bold">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ *</label>
                            <input type="date" class="form-control" id="appointmentDate" required>
                        </div>
                        
                        <div class="col-12">
                            <label class="form-label fw-bold">Ø³Ø¨Ø¨ Ø§Ù„Ù…ÙˆØ¹Ø¯ *</label>
                            <select class="form-select" id="appointmentReason" required>
                                <option value="">Ø§Ø®ØªØ± Ø³Ø¨Ø¨ Ø§Ù„Ù…ÙˆØ¹Ø¯</option>
                                <option value="Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø±Ø®ØµØ© Ø¨Ù†Ø§Ø¡">Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø±Ø®ØµØ© Ø¨Ù†Ø§Ø¡</option>
                                <option value="ØªØ¬Ø¯ÙŠØ¯ ØªØ±Ø®ÙŠØµ">ØªØ¬Ø¯ÙŠØ¯ ØªØ±Ø®ÙŠØµ</option>
                                <option value="Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ù‡Ø§Ø¯Ø©">Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ù‡Ø§Ø¯Ø©</option>
                                <option value="Ø´ÙƒÙˆÙ‰ Ø¹Ù„Ù‰ Ø®Ø¯Ù…Ø©">Ø´ÙƒÙˆÙ‰ Ø¹Ù„Ù‰ Ø®Ø¯Ù…Ø©</option>
                                <option value="Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ù…Ø¹Ø§Ù…Ù„Ø©">Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ù…Ø¹Ø§Ù…Ù„Ø©</option>
                                <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
                            </select>
                        </div>
                        
                        <div class="col-12">
                            <label class="form-label fw-bold">Ø§Ù„ÙˆØµÙ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</label>
                            <textarea class="form-control" id="reasonDescription" rows="4" 
                                      placeholder="Ø§ÙƒØªØ¨ ÙˆØµÙØ§Ù‹ ØªÙØµÙŠÙ„ÙŠØ§Ù‹ Ù„Ø·Ù„Ø¨Ùƒ..."></textarea>
                        </div>
                        
                        <div class="col-12 text-center mt-4">
                            <button type="submit" class="btn btn-primary btn-lg" id="submitBtn">
                                <i class="fas fa-paper-plane me-2"></i>
                                Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø­Ø¬Ø²
                            </button>
                        </div>
                        
                        <div class="col-12 text-center mt-3">
                            <a href="index-firebase.html" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-right me-2"></i>
                                Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                            </a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal fade" id="successModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-check-circle me-2"></i>ØªÙ… Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­
                    </h5>
                </div>
                <div class="modal-body text-center">
                    <div class="mb-3">
                        <i class="fas fa-calendar-check fa-3x text-success"></i>
                    </div>
                    <h5>ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!</h5>
                    <p class="text-muted">Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø·Ù„Ø¨Ùƒ ÙˆØ§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙƒ ÙÙŠ Ø£Ù‚Ø±Ø¨ ÙˆÙ‚Øª</p>
                    <div class="alert alert-info">
                        <strong>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</strong> <span id="appointmentId"></span>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="location.reload()">
                        Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ Ø¢Ø®Ø±
                    </button>
                    <a href="index-firebase.html" class="btn btn-outline-secondary">
                        Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module">
        // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„ØªØ§Ø±ÙŠØ® (ØºØ¯Ø§Ù‹)
        document.addEventListener('DOMContentLoaded', function() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('appointmentDate').min = tomorrow.toISOString().split('T')[0];
        });

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        document.getElementById('bookingForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.innerHTML;
            
            // ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø²Ø±
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
            
            try {
                // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                const appointmentData = {
                    national_id: document.getElementById('nationalId').value,
                    full_name: document.getElementById('fullName').value,
                    phone_number: document.getElementById('phoneNumber').value,
                    appointment_date: document.getElementById('appointmentDate').value,
                    appointment_reason: document.getElementById('appointmentReason').value,
                    reason_description: document.getElementById('reasonDescription').value,
                    status: 'pending',
                    created_at: new Date().toISOString(),
                    admin_notes: null
                };
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                if (!validateForm(appointmentData)) {
                    throw new Error('ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø©');
                }
                
                // Ø­ÙØ¸ ÙÙŠ Firebase
                if (window.firebaseDB) {
                    const docRef = await window.addDoc(
                        window.collection(window.firebaseDB, 'appointments'), 
                        appointmentData
                    );
                    
                    // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
                    document.getElementById('appointmentId').textContent = docRef.id;
                    const modal = new bootstrap.Modal(document.getElementById('successModal'));
                    modal.show();
                    
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                    document.getElementById('bookingForm').reset();
                    
                } else {
                    throw new Error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                }
                
            } catch (error) {
                console.error('Error:', error);
                showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨: ' + error.message, 'danger');
            } finally {
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø²Ø±
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        });

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        function validateForm(data) {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©
            if (!/^\d{10}$/.test(data.national_id)) {
                showAlert('Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 10 Ø£Ø±Ù‚Ø§Ù…', 'danger');
                return false;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„
            if (!/^05\d{8}$/.test(data.phone_number)) {
                showAlert('Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 05 ÙˆÙŠØªÙƒÙˆÙ† Ù…Ù† 10 Ø£Ø±Ù‚Ø§Ù…', 'danger');
                return false;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ§Ø±ÙŠØ®
            const selectedDate = new Date(data.appointment_date);
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            if (selectedDate < tomorrow) {
                showAlert('ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙˆØ¹Ø¯ ØºØ¯Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'danger');
                return false;
            }
            
            return true;
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
        function showAlert(message, type = 'info') {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} alert-dismissible fade show`;
            alert.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'danger' ? 'exclamation-circle' : 'info-circle'} me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            container.appendChild(alert);
            
            // Ø¥Ø²Ø§Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†ÙŠ
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, 5000);
        }
    </script>
</body>
</html>